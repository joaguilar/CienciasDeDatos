---
title: "Tarea 4"
author: "Jose Aguilar, Eilyn Salazar, Crisia Piedra"
date: "5/16/2020"
output: html_document
---

```{r setup, include=FALSE}
if(!require(arules)) install.packages("arules",dependencies = TRUE,repos=c(CRAN="https://cran.cnr.berkeley.edu/"))
library(arules)
if(!require(readxl)) install.packages("readxl",dependencies = TRUE,repos=c(CRAN="https://cran.cnr.berkeley.edu/"))
library("readxl")
library(ggplot2)
library(knitr)
if(!require(kableExtra)) install.packages("kableExtra",dependencies = TRUE,repos=c(CRAN="https://cran.cnr.berkeley.edu/"))
library(kableExtra)
library(arules)
library(arulesViz)

library(tidyverse)
if(!require(plyr)) install.packages("plyr",dependencies = TRUE)
library(plyr); library(dplyr)
library(ggplot2)
library(knitr)
library(lubridate)
if(!require(assertr)) install.packages("assertr",dependencies = TRUE)
library(assertr)
if(!require(reshape2)) install.packages("reshape2",dependencies = TRUE)
library(reshape2)
if(!require(rvest)) install.packages("rvest",dependencies = TRUE)
library(rvest)
if(!require(FactoMineR)) install.packages("FactoMineR",dependencies = TRUE)
library(FactoMineR)
if(!require(ggplot2)) install.packages("ggplot2",dependencies = TRUE)
library(ggplot2)
```
# Entendimiento del negocio

Para esta tarea se hará uso de la siguiente página  https://en.wikipedia.org/wiki/List_of_highest-grossing_video_game_franchises, la cual muestra las franquicias de video juegos con mayores ingresos.

El objetivo es explorar cuales son las compañias de juegos y franquicias más rentables

#	Entendimiento de los datos

La página seleccionada para realizar este análisis "List of highest-grossing video game franchises" está estructurada en 5 secciones: 

* Sección 1: Introducción en donde se explica el contenido de la página. El cuál es el mostrar el listado de compañías de juegos más rentables agrupados en 4 grandes grupos basado en el rango de ingresos en los que se encuentra cada franquicia, ya sean 10,5,2 o 1 millón de dólares 
* Sección 2: Detalle de los ingresos (Tablas). Para cada grupo se muestra una tabla la cual muestra el nombre de la Franquicia (Franchise), el año de creación (Year of inception), los ingresos de por vida (Lifetime revenue), Desglose de ingresos (Revenue breakdown), Dueño de la franquicia (Franchise owner), Plataforma Original (Original platforms), Genero Original (Original genre)
* Sección 3: Temas relacionados: URLs a sitios que contienen información relacionada a la página seleccionada.
* Sección 4: Notas.
* Sección 5: Referencias.

Para efectos del trabajo se hará uso únicamente de la sección 2, a continuación se presenta la caracterización de los atributos incluidos en cada tabla.


```{r warning=FALSE}
atributos<-read.csv('atributos.csv', sep = ',',dec = '.')
kable(atributos[,0:4],caption = "Descripción de los atributos")%>%
kable_styling(bootstrap_options = c("striped", "hover"))
```


## Exploración de los datos 

Se procede a realizar la extracción de los datos de cada tabla, los cuales se almacenarán en las variables, datos10m, datos5m, datos2m and datos1m.

```{r}
dirPag<-'https://en.wikipedia.org/wiki/List_of_highest-grossing_video_game_franchises'
pag<- read_html(dirPag,encoding = 'UTF-8')  
  
# se extraen específicamente las tablas que contenga la página
tablasPag<- html_table(pag,fill=TRUE)
length(tablasPag)
tablasPag
  
# Se obtienen las 4 tablas que agrupan los juegos de la compañia por cada uno de los juegos
datos10m<- tablasPag[[1]]
datos5m<- tablasPag[[2]]
datos2m<- tablasPag[[3]]
datos1m<- tablasPag[[4]]

# Se procede a añadir una columna categoria, para unir los valores de las tablas en un solo dataset.
datos10m['Categoria'] <- '10m'
datos5m['Categoria'] <- '5m'
datos2m['Categoria'] <- '2m'
datos1m['Categoria'] <- '1m'

#Se unen todos los dataframes en una sola.
datos <- rbind(datos10m,datos5m,datos2m,datos1m)
```

Una vez cargados los datos se preocede a hacer la exploración de los mismos. Como se puede apreciar, la mayoria de atributos al ser extraidos, son de tipo alfanumérico o caracter, en el caso del atributo "Year of inception" nos muestra que las fechas de creación de las franquicias van desde el año 1978 al año 2009.

```{r}
summary(datos)
```
## Verificación de la calidad de datos

Al explorar los datos es posible ver que no hay valores nulos o NAs. Con respecto a la normalización de los datos, se observan oportunidades de normalización de atributos como "Revenue breakdown", por ejemplo la franquicia "Mario", tiene agrupados sus ingresos en 3 juegos "Super Mario", "Mario Cart" y "Otros Mario games", sin embargo en el caso de "Call of Duty" los ingresos están agrupados por rangos de años o año, ejemplo: "2003-2017", "2018" y "2019".
 
#	Preparación de los datos 

## Selección de los datos 

Para efectos del trabajo se excluirá unicamente la columna Revenue Breakdown

```{r}
#Se remueve la columna Revenue Breakdown
datos<-datos[,-4] 
colnames(datos)

#Se renombran las nombres de las columnas
colnames(datos)<-c('Franquicia','Anno','Ingresos','Duenno','Plataforma','Genero', 'Categoria')
datos
```

## Limpieza de los datos 

```{r warning=FALSE}
revenue<- str_remove(datos10m$'Lifetime revenue','est\\.')
revenue<- str_remove(revenue,'\\s*\\$')
revenue<- str_remove(revenue,' billion.*$')
```


```{r warning=FALSE}
revenue<- str_remove(datos1m$'Lifetime revenue','est\\.')
revenue<- str_remove(revenue,'\\s*\\$')
revenue<- str_remove(revenue,' billion.*$')
revenue<- as.numeric(revenue)*1000000000
datos1m$'Lifetime revenue'<-revenue
datos1m
```

Dejamos solamente el primer genero en el que fue clasificada la franquicia.

```{r warning=FALSE}
genres<-datos$Genero
genres<- str_remove(genres,' .*$')
datos$Genero <- genres
```

Dejamos solamente la primera plataforma en la que apareció la franquicia.

```{r warning=FALSE}
platfrom<-datos$Plataforma
platfrom
platfrom<- str_remove(platfrom,' /.*$')
platfrom<- str_remove(platfrom,'Comm.*$')
platfrom<- str_remove(platfrom,'HandheldPC.*$')
platfrom<- str_remove(platfrom,'PlayStationPC$')
platfrom<- str_remove(platfrom,'^IBM ')
platfrom<- str_replace(platfrom,'PlayStation 3Xbox 360','PlayStation 3')
platfrom<- str_replace(platfrom,'PS4Xbox OnePC','PS4')
datos$Plataforma<-platfrom
```

## Construcción de nuevos datos (atributos) 

```{r warning=FALSE}

```

## Transformaciones aplicadas a los datos 
 
En este caso 
 
#	Fase de modelado  

## Selección de técnicas (en este caso A priori)

Para esta 

## Construcción del modelo (en este caso serán conjuntos de reglas) 

####	Selección de los parámetros 

Para la 


##### Exploración de las transacciones

Para explorar 

####	Ejecución (generación de reglas, eliminación de subconjuntos,etc) 

##### Generación de las reglas usando A priori

Vamos a utilizar 

####	Descripción general de las reglas obtenidas (incluya al menos un gráfico) 

##### Visualización de las 3 mejores reglas (según confianza) - grafo

##### Visualización de  3 reglas - gráfico paracoord


#### Evaluación de los modelos 

#####	Muestre e interprete las mejores 3 reglas de cada conjunto generado 




#### Evaluación de los modelos 

